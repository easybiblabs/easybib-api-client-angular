!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var f;"undefined"!=typeof window?f=window:"undefined"!=typeof global?f=global:"undefined"!=typeof self&&(f=self),f.easybibApiClient=e()}}(function(){return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module){require("angular-storage"),module.exports=function(){"use strict";angular.module("easybib-api-client",["angular-storage"]).service("EasyBibApiClient",require("./easybib-api-client"))}()},{"./easybib-api-client":3,"angular-storage":2}],2:[function(){!function(){angular.module("angular-storage",["angular-storage.store"]),angular.module("angular-storage.cookieStorage",[]).service("cookieStorage",["$injector",function($injector){var $cookieStore=$injector.get("$cookieStore");this.set=function(what,value){return $cookieStore.put(what,value)},this.get=function(what){return $cookieStore.get(what)},this.remove=function(what){return $cookieStore.remove(what)}}]),angular.module("angular-storage.internalStore",["angular-storage.localStorage","angular-storage.sessionStorage"]).factory("InternalStore",["$log","$injector",function($log,$injector){function InternalStore(namespace,storage,delimiter){this.namespace=namespace||null,this.delimiter=delimiter||".",this.inMemoryCache={},this.storage=$injector.get(storage||"localStorage")}return InternalStore.prototype.getNamespacedKey=function(key){return this.namespace?[this.namespace,key].join(this.delimiter):key},InternalStore.prototype.set=function(name,elem){this.inMemoryCache[name]=elem,this.storage.set(this.getNamespacedKey(name),JSON.stringify(elem))},InternalStore.prototype.get=function(name){var obj=null;if(name in this.inMemoryCache)return this.inMemoryCache[name];var saved=this.storage.get(this.getNamespacedKey(name));try{obj="undefined"==typeof saved||"undefined"===saved?void 0:JSON.parse(saved),this.inMemoryCache[name]=obj}catch(e){$log.error("Error parsing saved value",e),this.remove(name)}return obj},InternalStore.prototype.remove=function(name){this.inMemoryCache[name]=null,this.storage.remove(this.getNamespacedKey(name))},InternalStore}]),angular.module("angular-storage.localStorage",["angular-storage.cookieStorage"]).service("localStorage",["$window","$injector",function($window,$injector){var localStorageAvailable=!!$window.localStorage;if(localStorageAvailable)try{$window.localStorage.setItem("testKey","test"),$window.localStorage.removeItem("testKey"),localStorageAvailable=!0}catch(e){localStorageAvailable=!1}if(localStorageAvailable)this.set=function(what,value){return $window.localStorage.setItem(what,value)},this.get=function(what){return $window.localStorage.getItem(what)},this.remove=function(what){return $window.localStorage.removeItem(what)};else{var cookieStorage=$injector.get("cookieStorage");this.set=cookieStorage.set,this.get=cookieStorage.get,this.remove=cookieStorage.remove}}]),angular.module("angular-storage.sessionStorage",["angular-storage.cookieStorage"]).service("sessionStorage",["$window","$injector",function($window,$injector){if($window.sessionStorage)this.set=function(what,value){return $window.sessionStorage.setItem(what,value)},this.get=function(what){return $window.sessionStorage.getItem(what)},this.remove=function(what){return $window.sessionStorage.removeItem(what)};else{var cookieStorage=$injector.get("cookieStorage");this.set=cookieStorage.set,this.get=cookieStorage.get,this.remove=cookieStorage.remove}}]),angular.module("angular-storage.store",["angular-storage.internalStore"]).provider("store",function(){var _storage="localStorage";this.setStore=function(storage){storage&&angular.isString(storage)&&(_storage=storage)},this.$get=["InternalStore",function(InternalStore){var store=new InternalStore(null,_storage);return store.getNamespacedStore=function(namespace,storage,key){return new InternalStore(namespace,storage,key)},store}]})}()},{}],3:[function(require,module){module.exports=function($q,$http,store,$timeout,easyBibApiAccessUrl){"use strict";var utils,self=this;self.store=store,self.$q=$q,self.$http=$http,utils={deleteAccessToken:function(){self.store.remove("easybib-api-access-data")},getAccessToken:function(){var deferred,accessData;return deferred=$q.defer(),accessData=store.get("easybib-api-access-data"),null!==accessData?(deferred.resolve(accessData),deferred.promise):($http.get(easyBibApiAccessUrl()).then(function(response){self.store.set("easybib-api-access-data",response.data),deferred.resolve(response.data)})["catch"](function(error){deferred.reject(error)}),deferred.promise)},createRequest:function(initObj,token){var requestObj;return requestObj={method:"GET",headers:{Accept:"application/vnd.com.easybib.data+json",Authorization:"Bearer "+token}},angular.extend(requestObj,initObj),requestObj},retry:function(reqOpts,error,df,times,waitMs){var process;return utils.deleteAccessToken(),times="undefined"==typeof times?1:times,waitMs=waitMs||1e3,process=function(){utils.getAccessToken().then(function(accessData){reqOpts.headers.Authorization="Bearer "+accessData.access_token,self.request(reqOpts,times-1).then(function(data){df.resolve(data)},function(error){df.reject(error)})})},times>0?void $timeout(function(){process()},waitMs):void df.reject(error)}},self.retryCount=1,self.get=function(url){return utils.getAccessToken().then(function(accessData){var req=utils.createRequest({url:url},accessData.access_token);return self.request(req)})},self.post=function(url,data){return utils.getAccessToken().then(function(accessData){var req=utils.createRequest({method:"POST",data:{data:data},url:url},accessData.access_token);return self.request(req)})},self.put=function(url,data){return utils.getAccessToken().then(function(accessData){var req=utils.createRequest({method:"PUT",data:{data:data},url:url},accessData.access_token);return self.request(req)})},self["delete"]=function(url){return utils.getAccessToken().then(function(accessData){var req=utils.createRequest({method:"DELETE",url:url},accessData.access_token);return self.request(req)})},self.request=function(opts,retryCount){var deferred=self.$q.defer();return retryCount="undefined"==typeof retryCount?self.retryCount:retryCount,self.$http(opts).then(function(data){deferred.resolve(data)})["catch"](function(error){return 401===error.status||400===error.status?utils.retry(opts,error,deferred,retryCount):void deferred.reject(error)}),deferred.promise}}},{}]},{},[1])(1)});